<!DOCTYPE html>
<html>
  <head>
    <title>My Map Page</title>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100%;
        width: 100%;
      }
    </style>
  </head>

  <body>
    <div id="map"></div>

    <!-- ‚úÖ Load Google Maps -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADtj-pf2vXPtVbsito5U5AFwmKhJnWX18&callback=initMap"
      async
      defer>
    </script>

    <!-- ‚úÖ Firebase + Firestore (client-side) -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
      import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

      // üîë Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyC6ZBvAd5WE2dQ_iVdfVuF_uYq546B8QgI",
        authDomain: "iminister-map.firebaseapp.com",
        projectId: "iminister-map",
        storageBucket: "iminister-map.firebasestorage.app",
        messagingSenderId: "986772471255",
        appId: "1:986772471255:web:a3e3d5ec49f61a27815f92",
        measurementId: "G-TXWMLGM1G7"
      };

      // üöÄ Initialize Firebase + Firestore
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // üó∫Ô∏è Initialize Google Map
      window.initMap = async function () {
        const center = { lat: 43.816, lng: -111.784 }; // Center of map
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 13,
          center: center,
        });

        // üß† Load existing pins from Firestore
        const querySnapshot = await getDocs(collection(db, "pins"));
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          addMarker(map, data);
        });

        // üéØ Add new pin on map click
        map.addListener("click", async (event) => {
          const name = prompt("Enter name/title:");
          const link = prompt("Enter link (optional):");
          if (!name) return;

          const newPin = {
            name,
            lat: event.latLng.lat(),
            lng: event.latLng.lng(),
            link,
          };

          await addDoc(collection(db, "pins"), newPin);
          addMarker(map, newPin);
        });

        // üìç Helper function to create markers
        function addMarker(map, pin) {
          const marker = new google.maps.Marker({
            position: { lat: pin.lat, lng: pin.lng },
            map,
            title: pin.name,
          });

          const infoWindow = new google.maps.InfoWindow({
            content: `
              <strong>${pin.name}</strong><br>
              ${pin.link ? `<a href="${pin.link}" target="_blank">${pin.link}</a>` : ""}
            `,
          });

          marker.addListener("click", () => infoWindow.open(map, marker));
        }
      };
    </script>
  </body>
</html>
